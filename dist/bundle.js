document.addEventListener("DOMContentLoaded",(async()=>{const t=document.getElementById("decision-form"),e=document.getElementById("result"),n=document.getElementById("main-content"),d=document.getElementById("clear-button");let a=-1,u=await fetchSchedule();function o(t){n.innerHTML=t}t.addEventListener("submit",(n=>{n.preventDefault();const d=t.subject.value,o=t.group.value,r=t["exam-date"].value,i=t["exam-time"].value,l=new Date(`${r}T${i}`);if(!/[а-яА-ЯЁё]/.test(d))return void(e.textContent="Название дисциплины должно быть на русском языке.");if(!/^\d{2}[а-яА-Я]{1,2}\d$/.test(o))return void(e.textContent='Группа введенна некорректно(пример корректного ввода "21ВИ1", "22ВВП2").');new Date(`${r}T${i}`);const m=l.getMonth(),c=l.getFullYear();if(5!==m||2024!==c)return void(e.textContent="Экзамен должен быть назначен на июнь 2024 года.");const s=l.getHours();if(s<8||s>17)return void(e.textContent="Время экзамена должно быть с 8:00 до 17:00.");let b=!1,h=!1;u.forEach(((t,e)=>{const n=new Date(`${t.date}T${t.time}`),u=t.subject;l.getTime()===n.getTime()&&t.group===o&&(b=!0),u===d&&t.group===o&&(h=!0,a=e)})),b?e.textContent="На это время уже назначен другой экзамен. Пожалуйста, выберите другое время.":h&&-1===a?e.textContent="Экзамен по дисциплине уже назначен.":(e.textContent="Выбранное время свободно. Экзамен можно назначить на это время.",async function(t,n,d,o){a>=0?(u[a].date=d,u[a].time=o,e.textContent="Экзамен по дисциплине переназначен."):u.push({subject:t,group:n,date:d,time:o}),a=-1,await updateSchedule(u),u=await fetchSchedule()}(d,o,r,i))})),d.addEventListener("click",(()=>{t.subject.value="",t.group.value="",t["exam-date"].value="",t["exam-time"].value="",e.textContent=""})),document.getElementById("home-link").addEventListener("click",(t=>{t.preventDefault(),o('\n            <h2>Система назначения экзаменов</h2>\n            <form id="decision-form">\n                <label for="subject">Название дисциплины:</label>\n                <input type="text" id="subject" name="subject" required>\n\n                <label for="group">Группа:</label>\n                <input type="text" id="group" name="group" required>\n                \n                <label for="exam-date">Дата экзамена:</label>\n                <input type="date" id="exam-date" name="exam-date" required>\n                \n                <label for="exam-time">Время экзамена:</label>\n                <input type="time" id="exam-time" name="exam-time" required>\n\n                <button class="btn-new" type="submit">Назначить экзамен</button>\n                <button class="btn-new" type="button" id="reschedule-button" style="display: none;">Переназначить экзамен</button>\n            </form>\n            <div id="result"></div>\n        ')})),document.getElementById("subjects-link").addEventListener("click",(t=>{t.preventDefault(),o(function(){let t=u.map((t=>t.subject));return`\n            <h2>Дисциплины</h2>\n            <table>\n                <thead>\n                    <tr>\n                        <th>Название дисциплины</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${[...new Set(t)].map((t=>`<tr><td>${t}</td></tr>`)).join("")}\n                </tbody>\n            </table>\n        `}())})),document.getElementById("dates-link").addEventListener("click",(t=>{t.preventDefault(),o(function(){let t=u.map((t=>t.date));return`\n            <h2>Даты экзаменов</h2>\n            <table>\n                <thead>\n                    <tr>\n                        <th>Дата</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${[...new Set(t)].map((t=>`<tr><td>${t}</td></tr>`)).join("")}\n                </tbody>\n            </table>\n        `}())})),document.getElementById("groups-link").addEventListener("click",(t=>{t.preventDefault(),o(function(){let t=u.map((t=>t.group));return`\n            <h2>Группы</h2>\n            <table>\n                <thead>\n                    <tr>\n                        <th>Группа</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${[...new Set(t)].map((t=>`<tr><td>${t}</td></tr>`)).join("")}\n                </tbody>\n            </table>\n        `}())})),document.getElementById("schedule-link").addEventListener("click",(t=>{t.preventDefault(),o((u=u.sort(((t,e)=>new Date(`${t.date}T${t.time}`)-new Date(`${e.date}T${e.time}`))),`\n            <h2>Расписание экзаменов</h2>\n            <table>\n                <thead>\n                    <tr>\n                        <th>Дата</th>\n                        <th>Время</th>\n                        <th>Дисциплина</th>\n                        <th>Группа</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${u.map((t=>`\n                        <tr>\n                            <td>${t.date}</td>\n                            <td>${t.time}</td>\n                            <td>${t.subject}</td>\n                            <td>${t.group}</td>\n                        </tr>\n                    `)).join("")}\n                </tbody>\n            </table>\n        `))}))}));